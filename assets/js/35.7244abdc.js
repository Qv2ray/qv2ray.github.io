(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{402:function(_,v,e){"use strict";e.r(v);var t=e(16),a=Object(t.a)({},(function(){var _=this,v=_.$createElement,e=_._self._c||v;return e("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[e("h1",{attrs:{id:"手动构建-qv2ray-项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#手动构建-qv2ray-项目"}},[_._v("#")]),_._v(" 手动构建 Qv2ray 项目")]),_._v(" "),e("p",[_._v("本文针对喜欢折腾并想手动构建 Qv2ray 项目的爱好者们。")]),_._v(" "),e("h2",{attrs:{id:"_0-构建依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_0-构建依赖"}},[_._v("#")]),_._v(" 0. 构建依赖")]),_._v(" "),e("p",[_._v("请确保你的环境满足以下依赖的要求。")]),_._v(" "),e("ul",[e("li",[e("p",[_._v("对于桌面平台：仅支持 "),e("code",[_._v("x64")]),_._v(" 架构")])]),_._v(" "),e("li",[e("p",[_._v("对于 Android 平台："),e("code",[_._v("arm")]),_._v("、 "),e("code",[_._v("arm64")]),_._v("、 "),e("code",[_._v("x86")]),_._v(" 或 "),e("code",[_._v("x86_64")]),_._v(" 架构")])]),_._v(" "),e("li",[e("p",[_._v("桌面平台需要 Qt 版本 "),e("code",[_._v(">= 5.11")]),_._v(" ，Android 平台需要 Qt 版本 "),e("code",[_._v(">= 6.0")])]),_._v(" "),e("ul",[e("li",[e("s",[_._v("将 Qv2ray 移植到更低或更高版本的 Qt 时请无视该条件")])]),_._v(" "),e("li",[_._v("在这种情况下，您可能需要修改 "),e("code",[_._v("CMakeLists.txt")]),_._v(" 中的 "),e("code",[_._v("QV_QT_MAJOR_VERSION")]),_._v(" 和 "),e("code",[_._v("QV_QT_MINOR_VERSION")])])])]),_._v(" "),e("li",[e("p",[_._v("总是支持最新版本的 Qt ，推荐使用")])]),_._v(" "),e("li",[e("p",[_._v("支持 "),e("code",[_._v("std=c+17")]),_._v(" 的编译器：")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("gcc7")]),_._v(" 即可支持")]),_._v(" "),e("li",[_._v("最低 14.2 版本的 MSVC")])])]),_._v(" "),e("li",[e("p",[_._v("第三方库：(gRPC、protobuf、curl、openssl)")]),_._v(" "),e("table",[e("thead",[e("tr",[e("th",[_._v("目标平台")]),_._v(" "),e("th",[_._v("安装方式")])])]),_._v(" "),e("tbody",[e("tr",[e("td",[_._v("Linux")]),_._v(" "),e("td",[_._v("安装相应的软件包")])]),_._v(" "),e("tr",[e("td",[_._v("Windows (MSVC)")]),_._v(" "),e("td",[_._v("使用 "),e("code",[_._v("vcpkg")]),_._v(" 或使用 "),e("a",{attrs:{href:"#a-%E9%A2%84%E6%9E%84%E5%BB%BA%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6"}},[e("strong",[_._v("预构建的二进制文件")])])])]),_._v(" "),e("tr",[e("td",[_._v("Windows (MinGW)")]),_._v(" "),e("td",[_._v("见 "),e("a",{attrs:{href:"#mingw-packages"}},[_._v("下文")])])]),_._v(" "),e("tr",[e("td",[_._v("macOS")]),_._v(" "),e("td",[_._v("通过 "),e("code",[_._v("homebrew")]),_._v(" 安装软件包（注意：curl 已经被预先安装）")])]),_._v(" "),e("tr",[e("td",[_._v("Android")]),_._v(" "),e("td",[_._v("支持从 Linux 交叉编译，请使用"),e("a",{attrs:{href:"#a-prebuilt-binaries"}},[e("strong",[_._v("预构建的二进制文件")])]),_._v("，")])])])]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("Android 平台下的额外 Git 子模块")]),_._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/KDAB/android_openssl",target:"_blank",rel:"noopener noreferrer"}},[_._v("android-openssl"),e("OutboundLink")],1),_._v(" 提供了 OpenSSL 二进制文件：使用命令 "),e("code",[_._v("git clone https://github.com/KDAB/android_openssl 3rdparty/android-openssl")]),_._v(" 下载")])])])]),_._v(" "),e("h3",{attrs:{id:"a-预构建的二进制文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#a-预构建的二进制文件"}},[_._v("#")]),_._v(" a. 预构建的二进制文件")]),_._v(" "),e("ul",[e("li",[_._v("The "),e("a",{attrs:{href:"https://github.com/Qv2ray/Qv2ray-deps/",target:"_blank",rel:"noopener noreferrer"}},[_._v("Qv2ray-deps"),e("OutboundLink")],1),_._v(" repo is where we build and provide pre-built library dependencies for targeting Windows and Android.")]),_._v(" "),e("li",[_._v("对于安卓版本，我们使用了一个 "),e("a",{attrs:{href:"https://github.com/Qv2ray/Qv2ray-deps/blob/master/0001_vcpkg_fix_curl_android_build.patch",target:"_blank",rel:"noopener noreferrer"}},[_._v("修改过的"),e("OutboundLink")],1),_._v(" vcpkg。")])]),_._v(" "),e("h4",{attrs:{id:"a-1-下载-解压脚本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#a-1-下载-解压脚本"}},[_._v("#")]),_._v(" a.1 下载 / 解压脚本")]),_._v(" "),e("p",[e("strong",[_._v("额外依赖：bash 、 jq 、curl 、7zip")]),_._v(" （对于 Windows 用户）")]),_._v(" "),e("p",[_._v("我们提供了"),e("code",[_._v("./libs/setup-lib.sh")]),_._v(" ，可以很容易地安装预构建的二进制文件，用法：")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("cd")]),_._v("到"),e("code",[_._v("libs")]),_._v("目录")]),_._v(" "),e("li",[e("code",[_._v("./setup-libs <PLATFORM> <ARCH>")]),_._v(" "),e("ul",[e("li",[_._v("例如"),e("code",[_._v("./setup-libs.sh windows x64")]),_._v("或"),e("code",[_._v("./setup-libs.sh android arm")])]),_._v(" "),e("li",[_._v("可能的"),e("code",[_._v("<PLATFORM>")]),_._v("值： "),e("code",[_._v("windows")]),_._v(" ， "),e("code",[_._v("linux")]),_._v(" ， "),e("code",[_._v("android")])]),_._v(" "),e("li",[_._v("可能的"),e("code",[_._v("<ARCH>")]),_._v("值： "),e("code",[_._v("x86")]),_._v(" ， "),e("code",[_._v("x64")]),_._v(" ， "),e("code",[_._v("arm")]),_._v(" ， "),e("code",[_._v("arm64")])]),_._v(" "),e("li",[_._v("在 Linux 上为 Android 交叉编译时将"),e("code",[_._v("<ARCH>")]),_._v("设置为 "),e("code",[_._v("tools")]),_._v(" 以安装 Protobuf 生成器")])])])]),_._v(" "),e("p",[_._v("该脚本从 "),e("a",{attrs:{href:"https://github.com/Qv2ray/Qv2ray-deps/releases/tag/release",target:"_blank",rel:"noopener noreferrer"}},[_._v("此 release"),e("OutboundLink")],1),_._v(" 下载压缩包，解压并移动到相应的 "),e("code",[_._v("./libs/ARCH-PLATFORM/")]),_._v(" 目录。")]),_._v(" "),e("h4",{attrs:{id:"a-2-手动获取预构建的二进制文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#a-2-手动获取预构建的二进制文件"}},[_._v("#")]),_._v(" a.2 手动获取预构建的二进制文件")]),_._v(" "),e("ul",[e("li",[_._v("下载对应的 7z 压缩文件")]),_._v(" "),e("li",[_._v("解压并移动 "),e("code",[_._v("{7Z_ROOT}/PLATFORM-ARCH/installed/ARCH-PLATFORM")]),_._v(" 到 "),e("code",[_._v("./libs/")]),_._v(" 目录。")]),_._v(" "),e("li",[e("code",[_._v("./libs/ARCH-PLATFORM")]),_._v(" 下必须包含 "),e("code",[_._v("include")]),_._v(" ， "),e("code",[_._v("lib")]),_._v("或"),e("code",[_._v("share")]),_._v("子目录。\n"),e("ul",[e("li",[_._v("例如"),e("code",[_._v("./libs/x86-android/include")]),_._v(" 或 "),e("code",[_._v("./libs/x64-windows/include/")])])])])]),_._v(" "),e("h3",{attrs:{id:"mingw-软件包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mingw-软件包"}},[_._v("#")]),_._v(" MinGW 软件包：")]),_._v(" "),e("p",[_._v("建议使用 MSYS2 ，对应的软件包：")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("mingw-w64-x86_64-grpc")])]),_._v(" "),e("li",[e("code",[_._v("mingw-w64-x86_64-curl")])]),_._v(" "),e("li",[e("code",[_._v("mingw-w64-x86_64-protobuf")])]),_._v(" "),e("li",[e("code",[_._v("mingw-w64-x86_64-protobuf-c")])]),_._v(" "),e("li",[e("code",[_._v("mingw-w64-x86_64-pkg-config")])]),_._v(" "),e("li",[e("code",[_._v("mingw-w64-x86_64-re2")])])]),_._v(" "),e("h2",{attrs:{id:"_1-获取源树"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-获取源树"}},[_._v("#")]),_._v(" 1. 获取源树")]),_._v(" "),e("p",[_._v("There are various approaches to obtain the source code of Qv2ray. You can get it from:")]),_._v(" "),e("ul",[e("li",[_._v("Git: "),e("code",[_._v("https://github.com/Qv2ray/Qv2ray.git")])]),_._v(" "),e("li",[_._v("Directly download the source code of a branch ("),e("strong",[_._v("never do this due to the lack of git submodule metadata.")]),_._v(")")])]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("You can append options after `git clone`")]),_._v(" "),e("p",[e("code",[_._v("--branch <branch/tag>")]),_._v(" To checkout the specific branch/tag after clone is created.")])]),_._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[_._v("WARNING")]),_._v(" "),e("p",[_._v("Qv2ray contains nested submodules, always use "),e("code",[_._v("--recursive")]),_._v(" when cloning.")])]),_._v(" "),e("h2",{attrs:{id:"_2-进入编译目录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-进入编译目录"}},[_._v("#")]),_._v(" 2. 进入编译目录")]),_._v(" "),e("p",[_._v("以下步骤需要正确的 "),e("code",[_._v("PATH")]),_._v(" ，即可以在 "),e("code",[_._v("PATH")]),_._v(" 下找到 "),e("code",[_._v("qmake")]),_._v(" 。")]),_._v(" "),e("p",[_._v("执行： "),e("code",[_._v("mkdir build; cd build;")])]),_._v(" "),e("ul",[e("li",[_._v("只是为了防止污染源码树。")])]),_._v(" "),e("h2",{attrs:{id:"_3-生成编译脚本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-生成编译脚本"}},[_._v("#")]),_._v(" 3. 生成编译脚本")]),_._v(" "),e("p",[_._v("您"),e("strong",[_._v("需要")]),_._v("查看 "),e("a",{attrs:{href:"cmake-argument"}},[_._v("CMake 参数参考")]),_._v(" 并添加自己的参数。")]),_._v(" "),e("p",[_._v("执行： "),e("code",[_._v("cmake ..")])]),_._v(" "),e("p",[e("em",[e("strong",[_._v("构建 Android 时，使用 "),e("code",[_._v("qt-cmake ..")]),_._v(" 而不是 "),e("code",[_._v("cmake ..")])])])]),_._v(" "),e("ul",[e("li",[_._v("始终建议使用 "),e("code",[_._v("CMAKE_INSTALL_PREFIX")]),_._v(" ，以便一次性打包和收集所有必需的文件。")]),_._v(" "),e("li",[_._v("始终建议使用 "),e("code",[_._v("CMAKE_BUILD_TYPE")]),_._v(" ，请参阅 "),e("a",{attrs:{href:"https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html",target:"_blank",rel:"noopener noreferrer"}},[_._v("CMake文档"),e("OutboundLink")],1),_._v(" "),e("ul",[e("li",[e("code",[_._v("Debug")]),_._v(" 版本的 Qv2ray 配置目录名称将不同于 "),e("code",[_._v("Release")]),_._v(" 版本，以防止开发版构建污染正式版构建的配置文件。")])])]),_._v(" "),e("li",[_._v("如果您已安装"),e("code",[_._v("Ninja")]),_._v(" 或 "),e("code",[_._v("ninja-build")]),_._v(" ，建议使用 "),e("code",[_._v("-GNinja")])]),_._v(" "),e("li",[_._v("构建 Android 时可能需要"),e("code",[_._v("ANDROID_SDK_ROOT")]),_._v(" 或 "),e("code",[_._v("ANDROID_NDK_ROOT")])])]),_._v(" "),e("h2",{attrs:{id:"_4-start-compilation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-start-compilation"}},[_._v("#")]),_._v(" 4. Start Compilation")]),_._v(" "),e("p",[_._v("开始编译！")]),_._v(" "),e("p",[_._v("执行： "),e("code",[_._v("cmake --build .")])]),_._v(" "),e("ul",[e("li",[_._v("如果您拥有足够的算力并且想要执行并行编译，则推荐使用参数 "),e("code",[_._v("--parallel <并行数>")])])]),_._v(" "),e("h2",{attrs:{id:"_5-完成编译"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-完成编译"}},[_._v("#")]),_._v(" 5. 完成编译")]),_._v(" "),e("p",[_._v("将编译的成品和资源复制到目标目录中。")]),_._v(" "),e("p",[_._v("执行： "),e("code",[_._v("cmake --install .")]),_._v(" 或 "),e("code",[_._v("sudo cmake --install .")])]),_._v(" "),e("ul",[e("li",[_._v("这将自动复制所有依赖到 "),e("code",[_._v("CMAKE_INSTALL_PREFIX")]),_._v(" 。")])]),_._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[_._v("WARNING")]),_._v(" "),e("p",[e("code",[_._v("macdeployqt")]),_._v(" 中存在一个 bug ， "),e("code",[_._v("libabsl_debugging_internal")]),_._v(" 被识别为调试库，这将阻止部署 QPlatformPlugin（即 QCocoaPlugin ），最终将导致运行时异常，提示“ No Platform Plugin is Found ”。")]),_._v(" "),e("p",[_._v("请改用 "),e("a",{attrs:{href:"https://github.com/Qv2ray/macdeployqt-patched",target:"_blank",rel:"noopener noreferrer"}},[_._v("Qv2ray 修改过的 "),e("code",[_._v("macdeployqt")]),e("OutboundLink")],1),_._v(" 。同时支持 Qt5 和 Qt6")])]),_._v(" "),e("h2",{attrs:{id:"_6-完成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-完成"}},[_._v("#")]),_._v(" 6. 完成")]),_._v(" "),e("p",[_._v("你已经编译并部署了你自己的 Qv2ray！")]),_._v(" "),e("p",[_._v("开始折腾， Qv2ray 欢迎您的贡献！")])])}),[],!1,null,null,null);v.default=a.exports}}]);