<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>高级路由设置 | Qv2ray</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo.svg">
    <meta name="description" content="🌟 V2Ray Linux / Windows / macOS 跨平台 GUI 🔨 使用 C++17 / Qt5/6 ，支持订阅，扫描二维码，支持自定义路由编辑 🌟">
    <meta property="article:modified_time" content="null">
    <meta property="og:site_name" content="纵使千山多万壑，犹有青鸾踏云间">
    <meta property="og:title" content="Qv2ray Official Site">
    <meta property="og:description" content="跨平台 V2Ray GUI">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://qv2ray.net/">
    <meta property="og:image" content="https://avatars.githubusercontent.com/u/60087221?s=400&v=4">
    <meta name="twitter:title" content="Qv2ray Official Site">
    <meta name="twitter:description" content="跨平台 V2Ray GUI">
    <meta name="twitter:url" content="https://qv2ray.net/">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="https://avatars.githubusercontent.com/u/60087221?s=400&v=4">
    
    <link rel="preload" href="/assets/css/0.styles.e38e6b0d.css" as="style"><link rel="preload" href="/assets/js/app.2e1b24dc.js" as="script"><link rel="preload" href="/assets/js/3.d2db5c7e.js" as="script"><link rel="preload" href="/assets/js/38.fcae057d.js" as="script"><link rel="preload" href="/assets/js/8.b0f276f2.js" as="script"><link rel="prefetch" href="/assets/js/10.bc774f0d.js"><link rel="prefetch" href="/assets/js/11.b181a238.js"><link rel="prefetch" href="/assets/js/12.65937cb4.js"><link rel="prefetch" href="/assets/js/13.0f266a94.js"><link rel="prefetch" href="/assets/js/14.3ff32cc3.js"><link rel="prefetch" href="/assets/js/15.a32e90cf.js"><link rel="prefetch" href="/assets/js/16.fd838fc6.js"><link rel="prefetch" href="/assets/js/17.4c4fd583.js"><link rel="prefetch" href="/assets/js/18.50db1aaa.js"><link rel="prefetch" href="/assets/js/19.80cb8334.js"><link rel="prefetch" href="/assets/js/20.8f64713b.js"><link rel="prefetch" href="/assets/js/21.522cffb7.js"><link rel="prefetch" href="/assets/js/22.c57137a8.js"><link rel="prefetch" href="/assets/js/23.312670aa.js"><link rel="prefetch" href="/assets/js/24.8bf334cf.js"><link rel="prefetch" href="/assets/js/25.743a4281.js"><link rel="prefetch" href="/assets/js/26.0b25e2da.js"><link rel="prefetch" href="/assets/js/27.d05cabb9.js"><link rel="prefetch" href="/assets/js/28.28653392.js"><link rel="prefetch" href="/assets/js/29.43230b08.js"><link rel="prefetch" href="/assets/js/30.f1db2c51.js"><link rel="prefetch" href="/assets/js/31.656bb96c.js"><link rel="prefetch" href="/assets/js/32.f962da49.js"><link rel="prefetch" href="/assets/js/33.887dbd09.js"><link rel="prefetch" href="/assets/js/34.7085b75c.js"><link rel="prefetch" href="/assets/js/35.3c2353cb.js"><link rel="prefetch" href="/assets/js/36.26367e80.js"><link rel="prefetch" href="/assets/js/37.efa51808.js"><link rel="prefetch" href="/assets/js/39.b33a1577.js"><link rel="prefetch" href="/assets/js/4.4212682d.js"><link rel="prefetch" href="/assets/js/40.9b16001e.js"><link rel="prefetch" href="/assets/js/41.7b0b0828.js"><link rel="prefetch" href="/assets/js/42.80092062.js"><link rel="prefetch" href="/assets/js/43.9dee81f9.js"><link rel="prefetch" href="/assets/js/44.3fd367a4.js"><link rel="prefetch" href="/assets/js/45.4305eb6a.js"><link rel="prefetch" href="/assets/js/46.d6dd93d6.js"><link rel="prefetch" href="/assets/js/47.893fca74.js"><link rel="prefetch" href="/assets/js/48.cfe7a78e.js"><link rel="prefetch" href="/assets/js/49.b4995f9b.js"><link rel="prefetch" href="/assets/js/5.f6d392a5.js"><link rel="prefetch" href="/assets/js/50.7ca3e24a.js"><link rel="prefetch" href="/assets/js/51.a5e6c52f.js"><link rel="prefetch" href="/assets/js/6.5c4fd715.js"><link rel="prefetch" href="/assets/js/7.6815fcde.js"><link rel="prefetch" href="/assets/js/9.f69478b7.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.e78d7987.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e38e6b0d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lang/zh/" class="home-link router-link-active"><img src="/logo.svg" alt="Qv2ray" class="logo"> <span class="site-name can-hide">Qv2ray</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/lang/zh/getting-started/" class="nav-link">
  新手起步
</a></div><div class="nav-item"><a href="/lang/zh/manual/" class="nav-link router-link-active">
  用户手册
</a></div><div class="nav-item"><a href="/lang/zh/plugins/" class="nav-link">
  插件
</a></div><div class="nav-item"><a href="/lang/zh/hacking/" class="nav-link">
  折腾
</a></div><div class="nav-item"><a href="/lang/zh/faq/" class="nav-link">
  常见问题
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/manual/route.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/lang/zh/manual/route.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  中文
</a></li></ul></div></div> <div class="nav-item"><a role="button" aria-label="Switch to light mode" class="nav-link"><span>Switch theme</span></a></div> <a href="https://github.com/Qv2ray/Qv2ray" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/lang/zh/getting-started/" class="nav-link">
  新手起步
</a></div><div class="nav-item"><a href="/lang/zh/manual/" class="nav-link router-link-active">
  用户手册
</a></div><div class="nav-item"><a href="/lang/zh/plugins/" class="nav-link">
  插件
</a></div><div class="nav-item"><a href="/lang/zh/hacking/" class="nav-link">
  折腾
</a></div><div class="nav-item"><a href="/lang/zh/faq/" class="nav-link">
  常见问题
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/manual/route.html" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/lang/zh/manual/route.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  中文
</a></li></ul></div></div> <div class="nav-item"><a role="button" aria-label="Switch to light mode" class="nav-link"><span>Switch theme</span></a></div> <a href="https://github.com/Qv2ray/Qv2ray" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/lang/zh/manual/" aria-current="page" class="sidebar-link">Manual</a></li><li><a href="/lang/zh/manual/general.html" class="sidebar-link">常规设置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lang/zh/manual/general.html#外观" class="sidebar-link">外观</a></li><li class="sidebar-sub-header"><a href="/lang/zh/manual/general.html#行为" class="sidebar-link">行为</a></li><li class="sidebar-sub-header"><a href="/lang/zh/manual/general.html#网络设置" class="sidebar-link">网络设置</a></li><li class="sidebar-sub-header"><a href="/lang/zh/manual/general.html#高级行为" class="sidebar-link">高级行为</a></li></ul></li><li><a href="/lang/zh/manual/route.html" aria-current="page" class="active sidebar-link">高级路由设置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lang/zh/manual/route.html#全局路由规则" class="sidebar-link">全局路由规则</a></li><li class="sidebar-sub-header"><a href="/lang/zh/manual/route.html#路由编辑器" class="sidebar-link">路由编辑器</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-succinct-content content__default"><h1 id="高级路由设置"><a href="#高级路由设置" class="header-anchor">#</a> 高级路由设置</h1> <p><strong>高级路由设置</strong> 和 <strong>路由编辑器</strong> 是Qv2ray的特有功能。这两项功能可以帮助您精确地控制流量，如 <strong>按需代理</strong>，<strong>分流国内/国外网站</strong>等。你甚至可以 **设置代理链(多层套娃)**🤣~</p> <p>:::  路由功能是什么？为什么不用 PAC 和 GFW List？</p> <p>如果你不了解 V2ray 的路由功能具体是什么，那么你可以把它理解为一个更加简便，高效且精准的新一代 PAC 实现。</p> <p>路由功能 比 PAC 强大太多，以后请别再问为什么 Qv2ray 不支持 PAC 了。路由功能所采用的分流表也比 GFW List 更加完善，完全没有必要再使用GFW List。</p> <p>:::</p> <h2 id="全局路由规则"><a href="#全局路由规则" class="header-anchor">#</a> 全局路由规则</h2> <p>配置全局路由规则 请打开<strong>首选项</strong> ---&gt; <strong>高级路由设置</strong> 。</p> <h3 id="域名策略"><a href="#域名策略" class="header-anchor">#</a> 域名策略</h3> <p>Qv2ray 有三种域名匹配策略可选： <code>AsIs</code>、<code>IPIfNonMatch</code> 和 <code>IPOnDemand</code>。</p> <p>根据V2Ray的官方文档，这三种域名策略的定义如下：</p> <ul><li><strong><code>AsIs</code></strong>：只使用域名进行路由选择，默认值;</li> <li><strong><code>IPIfNonMatch</code></strong>：当域名没有匹配任何规则时，将域名解析成 IP（A 记录或 AAAA 记录）后再次进行匹配；
<ul><li>当一个域名有多个 A 记录时，会尝试匹配所有的 A 记录，直到其中一个与某个规则匹配为止；</li> <li>解析后的 IP 仅在路由选择时起作用，转发的数据包中依然使用原始域名;</li></ul></li> <li><strong><code>IPOnDemand</code></strong>：匹配时碰到任何基于 IP 的规则，立即将域名解析为 IP 后进行匹配;</li></ul> <p>用某位开发者的话说，就是：</p> <ul><li><strong><code>AsIs</code></strong>：分流速度快，但分流不够精确;</li> <li><strong><code>IPIfNonMatch</code></strong>：在牺牲部分速度的同时能带来足够精确的分流;</li> <li><strong><code>IPOndemand</code></strong>：别用;</li></ul> <blockquote><p>请注意: <code>IPOnDemand</code> 理论上是最慢而结果最准确的，然而在大多数情况下 <code>IPIfNonMatch</code> 已经足够准确了，所以 <code>IPOndemand</code> 的实际应用效果并不明显。</p></blockquote> <p>您可以根据您的实际需求选择最适合你的域名匹配策略。但就结果来说，一般情况下，<code>IPIfNonMatch</code> 是最佳选择。</p> <h3 id="路由策略"><a href="#路由策略" class="header-anchor">#</a> 路由策略</h3> <p>路由策略由 <code>3x2</code>  个区块组成，他们分别是（左上到右下）：<code>IP 直连</code>、<code>IP 代理</code>、<code>IP 阻断</code>、<code>域名直连</code>、<code>域名代理</code>、<code>域名阻断</code>，填入规则时请保持 <strong>每行一个，中间没有逗号分隔</strong>。</p> <p>Qv2ray 对于这些策略组的优先级排序是：<code>域名阻断</code> -&gt; <code>域名代理</code> -&gt; <code>域名直连</code> -&gt; <code>IP 阻断</code> -&gt; <code>IP 代理</code> -&gt; <code>IP 直连</code>。如果最后没有成功匹配，私有地址 和 中国大陆地址 会默认直连，其他地址则会使用代理。</p> <div class="custom-block tip"><p class="custom-block-title">我就想要全局代理~~~ 🤗</p> <p>很简单，清空所有的路由规则 然后打开 <strong>首选项</strong> ---&gt; <strong>链接设置</strong> 取消勾选 <strong>绕过私有地址</strong> 和 <strong>绕过中国大陆</strong> 即可 🙄</p></div> <p>根据 V2Ray 官方文档：</p> <p>IP规则有以下几种写法(按照是否常用排序):</p> <ul><li><strong>GeoIP</strong>：形如 &quot;geoip:cn&quot;，必须以 geoip:（小写）开头，后面跟双字符国家代码。例如 <code>geoip:cn</code> 包含了常见的中国IP地址，<code>geoip:us</code> 包含了常见的美国IP地址；</li> <li>特殊值：&quot;geoip:private&quot;（仅支持V2Ray 3.5+），包含所有私有地址，如 127.0.0.1。</li> <li>IP：直接填写，形如 &quot;127.0.0.1&quot;。</li> <li><strong>CIDR</strong>：形如 &quot;10.0.0.0/8&quot;。</li> <li><strong>从文件中加载 IP</strong>：形如 <code>&quot;ext:file:tag&quot;</code>，必须以 <code>ext:</code>（小写）开头，后面跟文件名（不带扩展名）和 标签，文件存放在 和 v2ray 核心文件相同的路径中。文件格式与 <code>geoip.dat</code> 相同，标签 必须在文件中声明。</li></ul> <p>域名规则有以下几种写法(按照是否常用排序):</p> <ul><li><strong>预定义域名列表</strong>：以 <code>geosite:</code> 开头，后面跟一个名称，例如 <code>geosite:google</code> 或 <code>geosite:cn</code> 名称 及 域名列表 请参考 <em>预定义域名列表</em></li> <li><strong>子域名</strong>：由 <code>&quot;domain:&quot;</code> 开始，后面跟一个域名。当此域名是目标域名或其子域名时，该规则生效。例如 <code>&quot;domain:v2ray.com&quot;</code> 匹配 <code>&quot;www.v2ray.com&quot;</code>、<code>&quot;v2ray.com&quot;</code>，但不匹配 <code>&quot;xv2ray.com&quot;</code>。</li> <li><strong>完全匹配</strong>： 由 <code>&quot;full:&quot;</code> 开始，后面跟一个域名。当此域名完整匹配目标域名时，该规则生效。例如 <code>&quot;full:v2ray.com&quot;</code> 匹配 <code>&quot;v2ray.com&quot;</code> 但不匹配 <code>&quot;www.v2ray.com&quot;</code>。</li> <li><strong>纯字符串</strong>：当此字符串匹配目标域名中任意部分，该规则生效。比如 <code>&quot;sina.com&quot;</code> 可以匹配 <code>&quot;sina.com&quot;</code>、<code>&quot;sina.com.cn&quot;</code> 和 <code>&quot;www.sina.com&quot;</code>，但不匹配 <code>&quot;sina.cn&quot;</code>。</li> <li><strong>正则表达式</strong>：由 <code>&quot;regexp:&quot;</code> 开始，余下部分是一个正则表达式。当此正则表达式匹配目标域名时，该规则生效。例如 <code>&quot;regexp:\\.goo.*\\.com$&quot;</code> 匹配 <code>&quot;www.google.com&quot;</code>、<code>&quot;fonts.googleapis.com&quot;</code>，但不匹配 <code>&quot;google.com&quot;</code>。</li> <li><strong>从文件中加载域名</strong>：形如 <code>&quot;ext:file:tag&quot;</code>，必须以 <code>ext:</code>（小写）开头，后面跟 文件名 和 标签 ，文件存放在与v2ray核心相同的路径中，文件格式与 <code>geosite.dat</code> 相同，标签 必须在文件中声明。</li></ul> <div class="custom-block tip"><p class="custom-block-title">长话短说，我是萌新 😅</p> <ul><li>如果你不想考虑分流 只想代理全部的流量，请按照上方的 全局代理 步骤操作 😅</li> <li>如果您想要实现精确的分流，即代理所有的出站流量，请点击下方的 <code>预设方案</code> 按钮。选择 <code>空白方案</code> 或 <code>空白方案（去广告）</code>，并将域名策略设置为 <code>IPIfNonMatch</code> 😋</li></ul></div> <div class="custom-block tip"><p class="custom-block-title">我是个老司机 ，我想要更加精准的分流！ 🤔</p> <p>我们推荐您使用一个更加细化的 V2ray 路由规则集 项目地址：<a href="https://github.com/Loyalsoldier/v2ray-rules-dat" target="_blank" rel="noopener noreferrer">Loyalsoldier/v2ray-rules-dat<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 🤗</p></div> <div class="custom-block tip"><p class="custom-block-title">我想可以自定义的分流规则！ 🤪</p> <p>请参考下一章节 <strong>路由编辑器</strong> 😄</p></div> <h2 id="路由编辑器"><a href="#路由编辑器" class="header-anchor">#</a> 路由编辑器</h2> <p>在 Qv2ray的主界面，<strong>右键点击</strong> 代理节点，然后选择 <strong>编辑为一个复杂配置</strong> 打开 <strong>路由编辑器</strong> 接口。</p> <p>在这个界面中，你可以把<strong>用户</strong>，<strong>源IP地址</strong>，<strong>目标IP地址</strong>，<strong>域名</strong>，<strong>目标域名</strong>，<strong>协议</strong>和<strong>端口</strong>任意设置组合，精准地设计出你想要的入站/出站规则. 你还可以调整不同规则之间的<strong>优先级</strong>，甚至可以实现<strong>负载均衡</strong>。</p> <p>需要再次重申的是，每条路由规则中的匹配条件是 <code>and</code> / <code>&amp;&amp;</code> 关系 也就是说，如果路由规则包含多个匹配条件，最终获得的实际匹配条件就是这些条件的交集。例如，如果路由规则包含 端口 规则 <code>443</code> 和 目标域名 规则 <code>qv2ray.github.io</code>，那么只有目标 <code>qv2ray.github.io:443</code> 符合这两项条件，并将与此项规则相匹配。</p> <p>如果您对 V2Ray 路由规则的作用机制不了解，请参阅V2Ray的官方文档。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Qv2ray/qv2ray.github.io/edit/source/docs/lang/zh/manual/route.md" target="_blank" rel="noopener noreferrer">编辑本页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/5/10上午9:58:55</span></div></footer> <div class="contributors" style="display:none;" data-v-6000aab7><span data-v-6000aab7>Contributors</span> </div> <div class="page-nav"><p class="inner"><span class="prev">
      ⟵
      <a href="/lang/zh/manual/general.html" class="prev">
        常规设置
      </a></span> <!----></p></div> </main></div><div class="global-ui"><div style="visibility:hidden;display:none;"></div><!----></div></div>
    <script src="/assets/js/app.2e1b24dc.js" defer></script><script src="/assets/js/3.d2db5c7e.js" defer></script><script src="/assets/js/38.fcae057d.js" defer></script><script src="/assets/js/8.b0f276f2.js" defer></script>
  </body>
</html>
